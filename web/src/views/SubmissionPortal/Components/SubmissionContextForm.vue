<script lang="ts">
import { defineComponent, ref } from '@vue/composition-api';
import {
  contextForm,
  contextFormValid,
  addressForm,
  addressFormValid,
} from '../store';
import SubmissionContextShippingForm from './SubmissionContextShippingForm.vue';

export default defineComponent({
  components: { SubmissionContextShippingForm },
  setup() {
    const formRef = ref();
    const showAddressForm = ref(false);
    const addressFormRef = ref();
    const date = ref(null);
    const datePicker = ref(false);
    const address = ref({});
    const sampleItems = ref(['water_extract_soil']);
    const biosafetyLevels = ref(['BSL2']);

    return {
      formRef,
      contextForm,
      contextFormValid,
      addressForm,
      addressFormValid,
      showAddressForm,
      addressFormRef,
      address,
      date,
      datePicker,
      sampleItems,
      biosafetyLevels,
    };
  },
});
</script>

<template>
  <div>
    <div class="text-h2">
      Submission Context
    </div>
    <div class="text-h5">
      Provide context about what your submission is.
    </div>
    <v-form
      ref="formRef"
      v-model="contextFormValid"
      style="max-width: 1000px;"
    >
      <v-radio-group
        v-model="contextForm.dataGenerated"
        label="Has data already been generated for your study?"
      >
        <v-radio
          label="No"
          :value="false"
        />
        <v-radio
          label="Yes"
          :value="true"
        />
      </v-radio-group>
      <v-checkbox
        v-if="contextForm.dataGenerated"
        v-model="contextForm.facilityGenerated"
        label="Data was generated by a DOE user facility"
        hide-details
        class="mb-2 mt-0"
      />
      <div v-if="contextForm.dataGenerated === false">
        <legend
          class="v-label theme--light mb-2"
          style="font-size: 14px;"
        >
          Are you submitting metadata for samples that will be sent to a DOE user factility?
        </legend>
        <v-checkbox
          v-model="contextForm.facilities"
          label="EMSL"
          value="EMSL"
          hide-details
        />
        <v-checkbox
          v-model="contextForm.facilities"
          label="JGI"
          value="JGI"
          hide-details
        />
        <submission-context-shipping-form
          v-if="contextForm.dataGenerated === false && contextForm.facilities.includes('EMSL')"
        />
        <!-- v-card
          v-if="contextForm.dataGenerated === false && contextForm.facilities.includes('EMSL')"
          class="mt-4 pa-0"
          outlined
        >
          <v-card-text
            class="pt-2"
            style="min-height: 100px;"
          >
            EMSL Shipping Info
          </v-card-text>
          <v-dialog
            v-model="showAddressForm"
            scrollable
            width="1200"
          >
            <template
              #activator="{ on, attrs }"
            >
              <v-btn
                absolute
                top
                right
                color="primary"
                v-bind="attrs"
                v-on="on"
              >
                Enter shipping info
              </v-btn>
            </template>
            <v-card>
              <v-card-title>
                <v-spacer />
                <span class="text-h5">Shipping Information</span>
                <v-spacer />
              </v-card-title>
              <v-card-text>
                <v-form
                  ref="addressFormRef"
                  class="ml-12"
                  style="max-width: 1000px"
                >
                  <v-subheader>
                    <span class="text-h6">Shipper</span>
                  </v-subheader>
                  <v-divider />
                  <v-text-field
                    v-model="addressForm.shipperName"
                    label="Shipper Name"
                    outlined
                    dense
                    class="mt-2"
                  />
                  <v-text-field
                    v-model="addressForm.shipperEmail"
                    label="E-mail Address"
                    outlined
                    dense
                  />
                  <v-text-field
                    v-model="addressForm.shipperPhone"
                    label="Phone Number"
                    outlined
                    dense
                  />
                  <v-text-field
                    v-model="addressForm.shipperAddress1"
                    label="Address Line 1"
                    outlined
                    dense
                  />
                  <v-text-field
                    v-model="addressForm.shipperAddress2"
                    label="Address Line 2"
                    outlined
                    dense
                  />
                  <v-text-field
                    v-model="addressForm.shipperCity"
                    label="City"
                    outlined
                    dense
                  />
                  <div class="d-flex">
                    <v-text-field
                      v-model="addressForm.shipperState"
                      label="State"
                      outlined
                      dense
                      class="mr-4"
                    />
                    <v-text-field
                      v-model="addressForm.shipperZip"
                      label="Zip Code"
                      outlined
                      dense
                    />
                  </div>
                  <v-textarea
                    v-model="addressForm.shippingConditions"
                    label="Shipping Conditions"
                    outlined
                    dense
                    rows="2"
                  />
                  <v-menu
                    ref="datePickerEl"
                    v-model="datePicker"
                    :close-on-content-click="false"
                    :return-value.sync="date"
                    transition="scale-transition"
                    offset-y
                    min-width="auto"
                  >
                    <template #activator="{ on, attrs }">
                      <v-text-field
                        v-model="addressForm.expectedShippingDate"
                        label="Expected Shipping Date"
                        append-icon="mdi-calendar"
                        readonly
                        outlined
                        dense
                        v-bind="attrs"
                        v-on="on"
                      />
                    </template>
                    <v-date-picker
                      v-model="addressForm.expectedShippingDate"
                      no-title
                      scrollable
                    >
                      <v-spacer />
                      <v-btn
                        text
                        color="primary"
                        @click="datePicker = false"
                      >
                        Cancel
                      </v-btn>
                      <v-btn
                        text
                        color="primary"
                        @click="$refs.menu.save(date)"
                      >
                        OK
                      </v-btn>
                    </v-date-picker>
                  </v-menu>
                  <v-subheader>
                    <span class="text-h6">Sample</span>
                  </v-subheader>
                  <v-divider />
                  <v-select
                    v-model="addressForm.sample"
                    class="mt-2"
                    :items="sampleItems"
                    label="Sample"
                    dense
                    outlined
                  />
                  <v-textarea
                    v-model="addressForm.description"
                    label="Sample Description"
                    hint="Number of samples, sample container type..."
                    outlined
                    dense
                    rows="2"
                  />
                  <v-textarea
                    v-model="addressForm.experimentalGoals"
                    label="Experiment Goals"
                    hint="Briefly describe the goal for your experiment"
                    outlined
                    dense
                    rows="2"
                  />
                  <v-textarea
                    v-model="addressForm.randomization"
                    label="Randomization"
                    hint="What experimental conditions will be used for"
                    outlined
                    dense
                    rows="1"
                  />
                  <div class="d-flex">
                    <v-checkbox
                      v-model="addressForm.usdaRegulated"
                      class="mr-4 mt-0"
                      label="USDA Regulated?"
                      hide-details
                    />
                    <v-text-field
                      v-model="addressForm.permitNumber"
                      label="Permit Number"
                      outlined
                      dense
                    />
                    <v-spacer />
                  </div>
                  <div class="d-flex">
                    <v-select
                      v-model="addressForm.biosafetyLevel"
                      class="mr-4"
                      :items="biosafetyLevels"
                      label="Biosafety Level"
                      dense
                      outlined
                    />
                    <v-checkbox
                      v-model="addressForm.irpOrHippa"
                      class="mt-0"
                      label="IRP/HIPAA?"
                    />
                    <v-spacer />
                  </div>
                  <v-subheader>
                    <span class="text-h6">Institutional Review Board (IRB) Information</span>
                  </v-subheader>
                  <v-divider class="mb-2" />
                  <v-text-field
                    v-model="addressForm.irbNumber"
                    label="IRB Number"
                    outlined
                    dense
                  />
                  <v-text-field
                    v-model="addressForm.irbName"
                    label="IRB Contact Name"
                    outlined
                    dense
                  />
                  <v-text-field
                    v-model="addressForm.irbEmail"
                    label="E-mail Address"
                    outlined
                    dense
                  />
                  <v-text-field
                    v-model="addressForm.irbPhone"
                    label="Phone Number"
                    outlined
                    dense
                  />
                  <v-text-field
                    v-model="addressForm.irbAddress1"
                    label="Address Line 1"
                    outlined
                    dense
                  />
                  <v-text-field
                    v-model="addressForm.irbAddress2"
                    label="Address Line 2"
                    outlined
                    dense
                  />
                  <v-text-field
                    v-model="addressForm.irbCity"
                    label="City"
                    outlined
                    dense
                  />
                  <div class="d-flex">
                    <v-text-field
                      v-model="addressForm.irbState"
                      label="State"
                      outlined
                      dense
                      class="mr-4"
                    />
                    <v-text-field
                      v-model="addressForm.irbZip"
                      label="Zip Code"
                      outlined
                      dense
                    />
                  </div>
                  <v-subheader>
                    <span class="text-h6">Additional Comments</span>
                  </v-subheader>
                  <v-divider class="mb-2" />
                  <v-textarea
                    v-model="addressForm.comments"
                    label="Comments"
                    outlined
                    dense
                    lines="4"
                  />
                </v-form>
              </v-card-text>
              <v-card-actions>
                <v-spacer />
                <v-btn
                  color="primary"
                  @click="showAddressForm = false"
                >
                  Save
                </v-btn>
                <v-spacer />
              </v-card-actions>
            </v-card>
          </v-dialog>
        </v-card -->
        <v-radio-group
          v-if="contextForm.dataGenerated === false && contextForm.facilities.length > 0"
          v-model="contextForm.award"
          label="What kind of project have you been awarded?"
        >
          <v-radio
            label="FICUS"
            value="FICUS"
          />
          <v-radio
            label="MONet"
            value="MONet"
          />
          <v-radio
            :value="contextForm.otherAward"
          >
            <template #label>
              <span class="mr-4">Other</span>
              <v-text-field
                v-model="contextForm.otherAward"
                class="pa-0 ma-0"
                dense
                hide-details
                outlined
              />
            </template>
          </v-radio>
        </v-radio-group>
      </div>
    </v-form>
    <strong>* indicates required field</strong>
    <div class="d-flex">
      <v-spacer />
      <v-btn
        color="gray"
        depressed
        :to="{ name: 'Study Form' }"
      >
        Go to next step
        <v-icon class="pl-1">
          mdi-arrow-right-circle
        </v-icon>
      </v-btn>
    </div>
  </div>
</template>
